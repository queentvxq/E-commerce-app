<!DOCTYPE html>
<html lang="en" class="m am-touch js cssanimations">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <link rel="stylesheet" href="assets/css/amazeui.css">
    <link rel="stylesheet" href="assets/css/amaze.min.css">
    <link rel="stylesheet" href="assets/css/ucj.css">
    <title>优厨家</title>
</head>

<body>
    <!--最外层容器，用于整体销毁，包含主场景和全局模块-->
    <div id="main">
        <!--内部主场景容器，包含顶部和底部导航内容-->
        <div class="am-page" id="m-main">
            <!--顶部内容-->
            <!--商城顶部搜索条-->
            <div class="am-g m-serch">
                <div class="am-u-sm-2">
                    <i class="am-icon-cx-31"></i>
                </div>
                
                <div class="am-u-sm-4">
                    <a class="active" id="load"><span>服务</span></a>
                </div>
                <div class="am-u-sm-4">
                    <a ><span>商城</span></a>
                </div>
                
                <div class="am-u-sm-2">
                    <a href=""><i class="am-icon-cx-27"></i></a>
                </div>
            </div>
            <div id="m-category" class="am-g m-category">
                <ul>
                    <li>餐具</li>
                    <li>厨具</li>
                    <li>家店</li>
                    <li>配件</li>
                    <li>餐具</li>
                    <li>厨具</li>
                    <li>家店</li>
                    <li>配件</li>
                </ul>
            </div>
            <!--End--顶部内容-->
            <!--主要内容------------------------->
            <div class="views wrapper discovery" id="wrapper">
                <!--商城首页-->
                <div class="mViews" id="mViews">
                    <div class="am-container" id="m_result">
                        <div id="m-result-pds">
                            <ul id="wf-main">
                                <li class="wf-cld">
                                    <div class="m-product">
                                        <a class="pdimg" href="#"><img src="assets/imgs/ad_i_1.jpg"></a>
                                        <a href="#" class="pdname">无垢 厨房深度保洁</a>
                                        <span class="pdprice">￥13800</span>
                                        <a class="wishList" href=""><i class="am-icon-cx-42"></i> 150</a>
                                    </div>
                                </li>
                                <li class="wf-cld">
                                    <div class="m-product">
                                        <a class="pdimg" href="#"><img src="assets/imgs/ad_i_1.jpg"></a>
                                        <a href="#" class="pdname">善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护</a>
                                        <span class="pdprice">￥13800</span>
                                        <a class="wishList" href=""><i class="am-icon-cx-42"></i> 150</a>
                                    </div>
                                </li>
                                <li class="wf-cld">
                                    <div class="m-product">
                                        <a class="pdimg" href="#"><img src="assets/imgs/ad_i_1.jpg"></a>
                                        <a href="#" class="pdname">西门子 烤箱</a>
                                        <span class="pdprice">￥13800</span>
                                        <a class="wishList" href=""><i class="am-icon-cx-27"></i></a>
                                    </div>
                                </li>
                                <li class="wf-cld">
                                    <div class="m-product">
                                        <a class="pdimg" href="#"><img src="assets/imgs/ad_i_1.jpg"></a>
                                        <a href="#" class="pdname">西门子 烤箱</a>
                                        <span class="pdprice">￥13800</span>
                                        <a class="wishList" href=""><i class="am-icon-cx-27"></i></a>
                                    </div>
                                </li>
                                <li class="wf-cld">
                                    <div class="m-product">
                                        <a class="pdimg" href="#"><img src="assets/imgs/ad_i_1.jpg"></a>
                                        <a href="#" class="pdname">西门子 烤箱</a>
                                        <span class="pdprice">￥13800</span>
                                        <a class="wishList" href=""><i class="am-icon-cx-27"></i></a>
                                    </div>
                                </li>
                                <li class="wf-cld">
                                    <div class="m-product">
                                        <a class="pdimg" href="#"><img src="assets/imgs/ad_i_1.jpg"></a>
                                        <a href="#" class="pdname">西门子 烤箱</a>
                                        <span class="pdprice">￥13800</span>
                                        <a class="wishList" href=""><i class="am-icon-cx-27"></i> 150</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="space100"></div>
                        <div class="space40"></div>
                    </div>
                </div>
            </div>
            <!--End--主要内容-------------------->
        </div>
 
    </div>
</body>

<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/amazeui.min.js"></script>
<script>
    function Waterfall(param){
    this.id = typeof param.container == 'string' ? document.getElementById(param.container) : param.container;
    this.colWidth = param.colWidth;
    this.colCount = param.colCount || 4;
    this.cls = param.cls && param.cls != '' ? param.cls : 'wf-cld';
    this.init();
    }
    Waterfall.prototype = {
        getByClass:function(cls,p){
            var arr = [],reg = new RegExp("(^|\\s+)" + cls + "(\\s+|$)","g");
            var nodes = p.getElementsByTagName("*"),len = nodes.length;
            for(var i = 0; i < len; i++){
                if(reg.test(nodes[i].className)){
                    arr.push(nodes[i]);
                    reg.lastIndex = 0;
                }
            }
            return arr;
        },
        maxArr:function(arr){
            var len = arr.length,temp = arr[0];
            for(var ii= 1; ii < len; ii++){
                if(temp < arr[ii]){
                    temp = arr[ii];
                }
            }
            return temp;
        },
        getMar:function(node){
            var dis = 0;
            if(node.currentStyle){
                dis = parseInt(node.currentStyle.marginBottom);
            }else if(document.defaultView){
                dis = parseInt(document.defaultView.getComputedStyle(node,null).marginBottom);
            }
            return dis;
        },
        getMinCol:function(arr){
            var ca = arr,cl = ca.length,temp = ca[0],minc = 0;
            for(var ci = 0; ci < cl; ci++){
                if(temp > ca[ci]){
                    temp = ca[ci];
                    minc = ci;
                }
            }
            return minc;
        },
        init:function(){
            var _this = this;
            var col = [],//列高
                iArr = [];//索引
            var nodes = _this.getByClass(_this.cls,_this.id),len = nodes.length;
            for(var i = 0; i < _this.colCount; i++){
                col[i] = 0;
            }
            for(var i = 0; i < len; i++){
                nodes[i].h = nodes[i].offsetHeight + _this.getMar(nodes[i]);
                iArr[i] = i;
            }
            
            for(var i = 0; i < len; i++){
                var ming = _this.getMinCol(col);
                nodes[i].style.left = ming * _this.colWidth + "%";
                nodes[i].style.top = col[ming] + "px";
                col[ming] += nodes[i].h;
            }
            
            _this.id.style.height = _this.maxArr(col) + "px";
        }
    };
    new Waterfall({
        "container":"wf-main",
        "colWidth":'47',
        "colCount":2
    });
    var l = $("#m-category>ul> li").length;
    $("#m-category>ul").css('width',l*5+2+'rem');

    var myScroll,hrzScroll;
    $(function($) {
        var IScroll = $.AMUI.iScroll;
        myScroll = new IScroll('#wrapper', {
            scrollbars: true,
            mouseWheel: true,
            interactiveScrollbars: true,
            shrinkScrollbars: 'scale',
            fadeScrollbars: true
        });
        hrzScroll = new IScroll('#m-category', {
            scrollX: true, scrollY: false, preventDefault: false,
            eventPassthrough: true
        });

        $('.am-slider').flexslider({
            start: function() {
                myScroll.refresh();
                console.log($('#m-index-ad').height());
            }
        });
/*************
***fake data test waterfall
**************/
        // $("#load").click(function(e){
        //     e.preventDefault();
        //     var html = '<li class="wf-cld"><div class="m-product"><a class="pdimg" href="#"><img src="assets/imgs/ad_i_1.jpg"></a><a href="#" class="pdname">无垢 厨房深度保洁</a><span class="pdprice">￥13800</span><a class="wishList" href=""><i class="am-icon-cx-42"></i> 150</a></div></li>'+
        //     '<li class="wf-cld"><div class="m-product"><a class="pdimg" href="#"><img src="assets/imgs/ad_i_1.jpg"></a><a href="#" class="pdname">善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护善器 厨房深度保洁 不让电器闲置 就是对它最大的呵护</a><span class="pdprice">￥13800</span><a class="wishList" href=""><i class="am-icon-cx-42"></i> 150</a></div></li>'+
        //                         '<li class="wf-cld"><div class="m-product"><a class="pdimg" href="#"><img src="assets/imgs/ad_i_1.jpg"></a><a href="#" class="pdname">西无垢 厨房深度保洁</a><span class="pdprice">￥13800</span><a class="wishList" href=""><i class="am-icon-cx-42"></i> 150</a></div></li>';
        //     $('#wf-main').append(html);
        //     new Waterfall({
        //         "container":"wf-main",
        //         "colWidth":'47',
        //         "colCount":2
        //     });
        // });


    })

    document.addEventListener('touchmove', function(e) {
        e.preventDefault();
    }, false);

</script>

</html>
